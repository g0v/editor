(this["webpackJsonpg0v-editor"]=this["webpackJsonpg0v-editor"]||[]).push([[0],{104:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(11),c=n.n(o),i=(n(83),n(22)),s=n(46),u=n(36),l=n.n(u),h=n(69),m=n(143),f=n(142),p=n(141),d=n(137),b=n(61),g=n(62),v=function(){function e(t,n,a){return Object(b.a)(this,e),this.connection=t,this.owner=n,this.repo=a,this}return Object(g.a)(e,[{key:"getReference",value:function(e){return this.connection.get("/repos/".concat(this.owner,"/").concat(this.repo,"/git/refs/heads/").concat(e))}},{key:"getCommit",value:function(e){return this.commit=this.connection.get(e.object.url),this.commit}},{key:"getTree",value:function(e){return this.connection.get(e.tree.url)}},{key:"createBlob",value:function(e){return this.connection.post("/repos/".concat(this.owner,"/").concat(this.repo,"/git/blobs"),{data:JSON.stringify({content:e,encoding:"utf-8"})})}},{key:"createTree",value:function(e){return this.connection.post("/repos/".concat(this.owner,"/").concat(this.repo,"/git/trees"),{data:JSON.stringify({base_tree:e.sha,tree:[{path:this.filename,mode:"100644",type:"blob",sha:this.blob.sha}]})})}},{key:"createCommit",value:function(e){return this.connection.post("/repos/".concat(this.owner,"/").concat(this.repo,"/git/commits"),{data:JSON.stringify({message:"update ".concat(this.filename),tree:e.sha,parents:[this.commit.sha]})})}},{key:"createReference",value:function(e){this.branch="update-".concat(this.filename,"-").concat(Date.now());var t={sha:e.sha,ref:"refs/heads/".concat(this.branch)};return this.connection.post("/repos/".concat(this.owner,"/").concat(this.repo,"/git/refs"),{data:JSON.stringify(t)})}},{key:"createPullRequest",value:function(e){var t={title:"update ".concat(this.filename),body:"this is a pull request from g0v editor",head:"".concat(this.owner,":").concat(this.branch),base:"master"};return this.connection.post("/repos/".concat(this.author,"/").concat(this.repo,"/pulls"),{data:JSON.stringify(t)})}},{key:"createFork",value:function(){var e=this;return new Promise((function(t,n){return e.connection.post("/repos/".concat(e.author,"/").concat(e.repo,"/forks")).done(t).fail(n)}))}}]),e}(),y=n(33),O=n.n(y),w=n(47),j=n(63),k=n.n(j),E=n(14),x=n(41),S=Object(d.a)((function(e){return{inputContainer:{marginBottom:e.spacing(2)},formContainer:{width:"100%"}}})),C=new k.a("v1").schema().properties,N=Object.keys(C).map((function(e,t){var n=C[e];return n.enum?r.a.createElement(x.a,{key:t,name:e,label:n.title,options:n.enum.map((function(e){return{label:e,value:e}})),getOptionValue:function(e){return e.value},getOptionLabel:function(e){return e.label},disableCloseOnSelect:!1,renderInput:function(e){return r.a.createElement(x.b,Object.assign({},e,{label:n.title,placeholder:n.description,variant:"outlined"}))}}):r.a.createElement(x.b,{key:t,name:e,label:n.title,variant:"outlined",placeholder:n.description,required:n.required})}));var R=function(e){var t=e.github,n=S(),o=Object(a.useState)({}),c=Object(i.a)(o,2),s=c[0],u=c[1],h=Object(a.useState)(!1),m=Object(i.a)(h,2),d=m[0],b=m[1],g=Object(a.useState)(void 0),v=Object(i.a)(g,2),y=v[0],j=v[1],k=function(){var e=Object(w.a)(O.a.mark((function e(n){var a,r,o,c,s,u,l,h,m,f;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),a="master",Object.keys(n).forEach((function(e){"array"===C[e].type&&(n[e]=n[e].split(",").filter((function(e){return e})))})),r=JSON.stringify(n,null,"  "),t.filename="g0v.json",o=n.repo.split("/"),c=Object(i.a)(o,2),t.author=c[0],t.repo=c[1],e.next=11,t.createFork();case 11:return e.next=13,t.createBlob(r);case 13:return t.blob=e.sent,e.next=16,t.getReference(a);case 16:return s=e.sent,e.next=19,t.getCommit(s);case 19:return t.commit=e.sent,e.next=22,t.getTree(t.commit);case 22:return u=e.sent,e.next=25,t.createTree(u);case 25:return l=e.sent,e.next=28,t.createCommit(l);case 28:return h=e.sent,e.next=31,t.createReference(h);case 31:return m=e.sent,e.next=34,t.createPullRequest(m);case 34:f=e.sent,j(f.html_url),b(!1);case 37:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=function(){window.open(y,"_blank","noopener,noreferrer")};return Object(a.useEffect)((function(){Object(w.a)(O.a.mark((function e(){var t,n,a,r,o;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.a.parse(window.location.search),n=t,!(a=t.repo)){e.next=12;break}return r="https://raw.githubusercontent.com/".concat(a,"/master/g0v.json"),e.next=7,fetch(r);case 7:if(!(o=e.sent).ok){e.next=12;break}return e.next=11,o.json();case 11:n=e.sent;case 12:Object.keys(n).forEach((function(e){C[e]?"string"===C[e].type?n[e]=T(n[e]):"array"===C[e].type&&(Array.isArray(n[e])?n[e]=n[e].map(T).join(","):n[e]=T(n[e])):delete n[e]})),a&&(n.repo=a),u(n);case 15:case"end":return e.stop()}}),e)})))()}),[]),r.a.createElement(E.b,{onSubmit:k,initialValues:s,render:function(e){var t=e.handleSubmit;return r.a.createElement("form",{onSubmit:t,noValidate:!0,className:n.formContainer},r.a.createElement(f.a,{container:!0,direction:"column",alignContent:"stretch"},N.map((function(e,t){return r.a.createElement(f.a,{item:!0,className:n.inputContainer,key:t},e)}))),r.a.createElement(f.a,{container:!0,justify:"center"},y?r.a.createElement(p.a,{color:"primary",variant:"contained",onClick:x},"\u524d\u5f80 GitHub PR \u9801\u9762"):r.a.createElement(p.a,{color:"primary",variant:"contained",type:"submit",disabled:d},"\u5efa\u7acb Pull Request")))}})};function T(e){return"object"===typeof e?JSON.stringify(e):e}s.OAuth.initialize("M-bBVCTcOy9vIq7TRkJoL17N6LQ");var q=Object(h.a)({palette:{primary:{main:"#05D4A6",dark:"#05D4A6",contrastText:"#fff"}}}),J=Object(d.a)((function(e){return{header:{width:"100%",textAlign:"center",backgroundColor:"#F4F4F4",paddingTop:50,paddingBottom:50},headerTitle:{fontFamily:"Helvetica",fontSize:24,color:"#000000"},headerContent:{margin:"0 auto",width:400},container:{padding:e.spacing(2),width:500,margin:"0 auto"}}}));var A=function(){var e=J(),t=Object(a.useState)(!1),n=Object(i.a)(t,2),o=n[0],c=n[1],u=Object(a.useState)(null),h=Object(i.a)(u,2),d=h[0],b=h[1],g=Object(a.useState)(!0),y=Object(i.a)(g,2),O=y[0],w=y[1],j=function(e){c(!0),s.OAuth.popup("github").done((function(e){return e.get("/user").done((function(t){c(!1),b(new v(e,t.login))}))})).fail(console.error)};return Object(a.useEffect)((function(){var e=l.a.parse(window.location.search),t=e.hideHeader,n=e.autoLogin;t&&w(!1),n&&j()}),[]),r.a.createElement(m.a,{theme:q},O&&r.a.createElement("div",{className:e.header},r.a.createElement("img",{src:"logo.png",alt:"logo"}),r.a.createElement("h1",{className:e.headerTitle},"g0v metadata editor"),r.a.createElement("p",{className:e.headerContent},"The form below will help you build a valid g0v.json file. Fill out all of the required fields (marked by a star) and any others. Next, you can click the buttons at the bottom of the page to render and create a Pull Request to target repository.")),r.a.createElement(f.a,{container:!0,justify:"center",className:e.container},!d&&r.a.createElement(p.a,{color:"primary",variant:"contained",onClick:j,style:{fontWeight:"bold"},disabled:o,disableElevation:!0},"\u7528 github \u767b\u5165\u4ee5\u5efa\u7acb Pull Request"),d&&r.a.createElement(R,{github:d})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(A,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},78:function(e,t,n){e.exports=n(104)},83:function(e,t,n){}},[[78,1,2]]]);
//# sourceMappingURL=main.2fac5053.chunk.js.map